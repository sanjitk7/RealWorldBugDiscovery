diff --git a/ugs-core/src/com/willwinder/universalgcodesender/gcode/GcodeParser.java b/ugs-core/src/com/willwinder/universalgcodesender/gcode/GcodeParser.java
index 750100bf3..d64e38b9c 100644
--- a/ugs-core/src/com/willwinder/universalgcodesender/gcode/GcodeParser.java
+++ b/ugs-core/src/com/willwinder/universalgcodesender/gcode/GcodeParser.java
@@ -124,6 +124,7 @@ public class GcodeParser implements IGcodeParser {
     public void reset() {
         this.statsProcessor = new Stats();
         this.state = new GcodeState();
+        this.state.commandNumber = -1;
     }
     
     /**
diff --git a/ugs-core/test/com/willwinder/universalgcodesender/model/GUIBackendPreprocessorTest.java b/ugs-core/test/com/willwinder/universalgcodesender/model/GUIBackendPreprocessorTest.java
index 9b7d8fce8..886ff465a 100644
--- a/ugs-core/test/com/willwinder/universalgcodesender/model/GUIBackendPreprocessorTest.java
+++ b/ugs-core/test/com/willwinder/universalgcodesender/model/GUIBackendPreprocessorTest.java
@@ -118,7 +118,7 @@ public class GUIBackendPreprocessorTest {
         // Create GcodeStream input file by putting it through the preprocessor.
         List<String> lines = Arrays.asList("line one", "line two");
         Files.write(outputFile, lines, Charset.defaultCharset(), StandardOpenOption.WRITE);
-        try (IGcodeWriter gcw = new GcodeStreamWriter(outputFile.toFile())) {
+        try (IGcodeWriter gcw = new GcodeStreamWriter(inputFile.toFile())) {
             backend.preprocessAndExportToFile(gcp, outputFile.toFile(), gcw);
         }
 
diff --git a/ugs-core/test/resources/gcode/fixtures/run-from/outRunFrom/simple.g1.parsed_output.nc b/ugs-core/test/resources/gcode/fixtures/run-from/outRunFrom/simple.g1.parsed_output.nc
index b81b3cb99..6a6a4c7b9 100644
--- a/ugs-core/test/resources/gcode/fixtures/run-from/outRunFrom/simple.g1.parsed_output.nc
+++ b/ugs-core/test/resources/gcode/fixtures/run-from/outRunFrom/simple.g1.parsed_output.nc
@@ -1,9 +1,9 @@
-G21G90G91.1G94G54G17F300.0S1000.0M3
+G21G90G91.1G94G54G17
 G0Z3.0
-G0X110.0Y10.0
+G0X110.0Y110.0
+M3S1000.0F300.0
 G1Z-0.9
-G1Y110F300.0S1000.0
-X10
+F300.0S1000.0G1X10
 Y10
 Z-1.2
 X110
diff --git a/ugs-core/test/resources/gcode/fixtures/run-from/outRunFrom/simple.g1.stream_output.nc b/ugs-core/test/resources/gcode/fixtures/run-from/outRunFrom/simple.g1.stream_output.nc
index a24e3e975..68625b5c8 100644
--- a/ugs-core/test/resources/gcode/fixtures/run-from/outRunFrom/simple.g1.stream_output.nc
+++ b/ugs-core/test/resources/gcode/fixtures/run-from/outRunFrom/simple.g1.stream_output.nc
@@ -1,10 +1,10 @@
 gsw_meta:44                                       
-Y110++G21G90G91.1G94G54G17F300.0S1000.0M3++18++
-Y110++G0Z3.0++18++
-Y110++G0X110.0Y10.0++18++
-Y110++G1Z-0.9++18++
-Y110++G1Y110F300.0S1000.0++18++
-X10++X10++19++
+X10++G21G90G91.1G94G54G17++19++
+X10++G0Z3.0++19++
+X10++G0X110.0Y110.0++19++
+X10++M3S1000.0F300.0++19++
+X10++G1Z-0.9++19++
+X10++F300.0S1000.0G1X10++19++
 Y10++Y10++20++
 Z-1.2++Z-1.2++21++
 X110++X110++22++
diff --git a/ugs-core/test/resources/gcode/fixtures/run-from/outRunFrom/simple.g2.parsed_output.nc b/ugs-core/test/resources/gcode/fixtures/run-from/outRunFrom/simple.g2.parsed_output.nc
index 6c62d5fe6..a0de0e069 100644
--- a/ugs-core/test/resources/gcode/fixtures/run-from/outRunFrom/simple.g2.parsed_output.nc
+++ b/ugs-core/test/resources/gcode/fixtures/run-from/outRunFrom/simple.g2.parsed_output.nc
@@ -1,9 +1,9 @@
-G20G90G91.1G94G54G17F5.0S0.0
+G20G90G91.1G94G54G17
 G0Z0.25
-G0X0.0Y-0.5
+G0X-0.5Y0.0
+S0.0F5.0
 G1Z-0.4
-G2X-0.5Y0.I0.J0.5F5.0S0.0
-G1 Z-.5
+F5.0S0.0G1Z-.5
 G2 X0. Y-0.5 I0.5 J0.
 G2 X-0.5 Y0. I0. J0.5
 G1 Z-.6
diff --git a/ugs-core/test/resources/gcode/fixtures/run-from/outRunFrom/simple.g2.stream_output.nc b/ugs-core/test/resources/gcode/fixtures/run-from/outRunFrom/simple.g2.stream_output.nc
index d5fbfa6ba..eaecc4f34 100644
--- a/ugs-core/test/resources/gcode/fixtures/run-from/outRunFrom/simple.g2.stream_output.nc
+++ b/ugs-core/test/resources/gcode/fixtures/run-from/outRunFrom/simple.g2.stream_output.nc
@@ -1,10 +1,10 @@
 gsw_meta:31                                       
-G2 X-0.5 Y0. I0. J0.5++G20G90G91.1G94G54G17F5.0S0.0++18++
-G2 X-0.5 Y0. I0. J0.5++G0Z0.25++18++
-G2 X-0.5 Y0. I0. J0.5++G0X0.0Y-0.5++18++
-G2 X-0.5 Y0. I0. J0.5++G1Z-0.4++18++
-G2 X-0.5 Y0. I0. J0.5++G2X-0.5Y0.I0.J0.5F5.0S0.0++18++
-G1 Z-.5++G1 Z-.5++19++
+G1 Z-.5++G20G90G91.1G94G54G17++19++
+G1 Z-.5++G0Z0.25++19++
+G1 Z-.5++G0X-0.5Y0.0++19++
+G1 Z-.5++S0.0F5.0++19++
+G1 Z-.5++G1Z-0.4++19++
+G1 Z-.5++F5.0S0.0G1Z-.5++19++
 G2 X0. Y-0.5 I0.5 J0.++G2 X0. Y-0.5 I0.5 J0.++20++
 G2 X-0.5 Y0. I0. J0.5++G2 X-0.5 Y0. I0. J0.5++21++
 G1 Z-.6++G1 Z-.6++22++
diff --git a/ugs-platform/ugs-platform-ugslib/src/main/java/com/willwinder/ugs/nbp/lib/services/ActionRegistrationService.java b/ugs-platform/ugs-platform-ugslib/src/main/java/com/willwinder/ugs/nbp/lib/services/ActionRegistrationService.java
index 1221d628d..9d6f9dcb4 100644
--- a/ugs-platform/ugs-platform-ugslib/src/main/java/com/willwinder/ugs/nbp/lib/services/ActionRegistrationService.java
+++ b/ugs-platform/ugs-platform-ugslib/src/main/java/com/willwinder/ugs/nbp/lib/services/ActionRegistrationService.java
@@ -47,6 +47,22 @@ public class ActionRegistrationService {
     private static final String SHADOW = "shadow";
     private static final Logger LOGGER = Logger.getLogger(ActionRegistrationService.class.getSimpleName());
 
+    /**
+     * Update an {@link ActionReference} already registered with the platform along with optional shortcuts and
+     * menu items.
+     *
+     * @param reference    Name and ID of the action.
+     * @param category     Category in the Keymap tool.
+     * @param shortcut     Default shortcut, use an empty string or null for none.
+     * @param menuPath     Menu location starting with "Menu", like "Menu/Head/Hats"
+     * @param menuPosition Defines how the menu item should be ordered
+     * @param localMenu    Localized menu location starting with "Menu", like "Menu/Cabeza/Sombreros"
+     * @throws IOException if the action couldn't be registered
+     */
+    public void updateAction(ActionReference reference, String category, String shortcut, String menuPath, int menuPosition, String localMenu) throws IOException {
+        registerAction(reference.getId(), reference.getName(), category, shortcut, menuPath, menuPosition, localMenu, reference.getAction());
+    }
+
     /**
      * Registers an action with the platform along with optional shortcuts and
      * menu items.
